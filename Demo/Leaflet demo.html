<!doctype html>  
<html lang="en-EN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
	
		<title>Leaflet view — MooGIS demo</title>
		<meta name="author" content="Matti Schneider-Ghibaudo">
		
		<script language="javascript" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/mootools/1.3.2/mootools-yui-compressed.js"></script>
		<script language="javascript" type="text/javascript" src="../Source/MooGIS.js"></script>

		<script language="javascript" type="text/javascript" src="../Source/MooGIS.View.js"></script>
		<script language="javascript" type="text/javascript" src="../Source/MooGIS.View.Map.js"></script>
		
		<script language="javascript" type="text/javascript" src="../Source/MooGIS.Source.js"></script>
		<script language="javascript" type="text/javascript" src="../Source/MooGIS.Source.GeoJSON.js"></script>
		
		<script language="javascript" type="text/javascript" src="https://raw.github.com/CloudMade/Leaflet/v0.2.1/dist/leaflet.js"></script>
		<script language="javascript" type="text/javascript" src="../Source/MooGIS.View.Map.Leaflet.js"></script>
		
		<link rel="stylesheet" type="text/css" href="assets/leaflet.css"/> <!-- don't ask me why raw.github.com doesn't want to serve the css as it serves the js… -->
		
		<style>
			h1 {
				position: fixed;
				z-index: 1;
				right: 1em;
			}
			
			body {
				margin: 0;
			}
			
			#main, #map {
				width: 100%;
				height: 100%;
				position: absolute;
			}
		</style>
	</head>
	
	<body>
	    <header>
	    	<h1>MooGIS with Leaflet view</h1>
	    </header>
	    
	    <div id="main" role="main">
	    	
		</div>
		  
		<footer>
		</footer>
		
		<script type="text/javascript">
		//<![CDATA[
			var view = new MooGIS.View('main');
			
			view.setMap('Leaflet', {
				tileLayer: {
					url: 'http://{s}.tile.cloudmade.com/2c285efc8cee49bc9c87536b51066677/997/256/{z}/{x}/{y}.png'
				},
				geojsonChannel: {
					onFeatureparse: function(e) {
						var popup = '<dl>';
						Object.each(e.properties, function(val, key) {
							popup += '<dt>' + key + '</dt><dd>' + (val || '<em>No value</em>') + '</dd>';
						});
						popup += '</dl>';
						e.layer.bindPopup(popup);
					}
				}
			});
			
//			var source = new MooGIS.Source.GeoJSON('https://github.com/MattiSG/MooGIS/raw/master/Demo/assets/GeoJSONdemo.json');
//			var source = new MooGIS.Source.GeoJSON('http://elasticrash.info/demos/TwitterApp/oath/geoJSON/country.geojson');
			var source = new MooGIS.Source.GeoJSON('http://localhost/frontend_dev.php/analyser/geo.json');

			view._mapView.addStream('Geojson', source);

			source.addEvent('error', console.warn.bind(console)); // don't include this in production 
			
			source.load();
			
//			var controller = new MooGIS.Controller(source, view, {
//				save: false // local demo
//			});
		//]]>
		</script>
	</body>
</html>